Number.prototype.formatMoney=function(e,t,r){var n=this,o=(e=isNaN(e=Math.abs(e))?2:e,t=null==t?".":t,r=null==r?",":r,n<0?"-":""),i=parseInt(n=Math.abs(+n||0).toFixed(e))+"",a=(a=i.length)>3?a%3:0;return o+(a?i.substr(0,a)+r:"")+i.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+r)+(e?t+Math.abs(n-i).toFixed(e).slice(2):"")};var rot_calc={dollar:null,init:function(){jQuery(".dollar").each(function(){jQuery(this).attr("placeholder","$")}),jQuery(".highcharts-root .highcharts-button").slideUp(),jQuery(".highcharts-root .highcharts-button").eq(0).slideDown(),jQuery(".highcharts-root .highcharts-button").eq(5).slideDown(),flatpickr(".date",{dateFormat:"m-d-y"}),new AutoNumeric.multiple(".dollar",{currencySymbol:"$",digitGroupSeparator:",",decimalPlaces:2,decimalCharacter:".",decimalPlacesOverride:2,minimumValue:-999999999.99,maximumValue:999999999.99,currencySymbolPlacement:"p"}),new AutoNumeric.multiple(".whole",{decimalPlaces:0,digitGroupSeparator:",",decimalCharacter:".",decimalPlacesOverride:0,minimumValue:-999999999,maximumValue:999999999,currencySymbolPlacement:"p"}),new AutoNumeric.multiple(".dollar-positive",{currencySymbol:"$",decimalPlaces:2,digitGroupSeparator:",",decimalCharacter:".",decimalPlacesOverride:2,minimumValue:0,maximumValue:999999999.99,currencySymbolPlacement:"p"}),this.listener(),this.calculate()},listener:function(){jQuery("#add_leg").click(function(){return jQuery(".clone_hide").first().addClass("clone").removeClass("clone_hide"),!1});var e=0;jQuery("#add_adj").click(function(){return e<9&&(jQuery("table tr").each(function(){jQuery(this).find("td").eq(e+4).css("display","table-cell"),jQuery(this).find("th").eq(e+4).css("display","table-cell")}),e++,!1)}),jQuery("#clear").click(function(){return jQuery(".rvv").each(function(){jQuery(this).html("-")}),jQuery(".frm").each(function(){jQuery(this).val("")}),jQuery(".dollar").each(function(){AutoNumeric.set("#"+jQuery(this).attr("id"),"")}),jQuery(".dollar-positive").each(function(){AutoNumeric.set("#"+jQuery(this).attr("id"),"")}),jQuery(".whole").each(function(){AutoNumeric.set("#"+jQuery(this).attr("id"),"")}),jQuery(".date").each(function(){jQuery(this).val("")}),rot_calc.calculate(),!1});for(var t=document.querySelectorAll("input[type='text']"),r=0;r<t.length;r++)t[r].addEventListener("change",function(e){rot_calc.calculate()});var n=document.querySelectorAll("input[type='radio']");for(r=0;r<n.length;r++)n[r].addEventListener("click",function(e){rot_calc.calculate()})},c__j:function(e,t,r,n){for(var o=parseFloat(AutoNumeric.getNumber("#size")),i=[],a=0;a<=e;a++){for(var l=0,s=0;s<jQuery(".leg").length;s++)l+=Math.max("c"==r[s].cp?n[a]-r[s].strike:r[s].strike-n[a],0)*r[s].contracts;i[a]=(t+l)*o}return i},odb:function(){for(var e=[],t=0;t<jQuery("th").length-1;t++){e[t]=[];for(var r=1;r<=jQuery(".leg").length;r++){var n=parseFloat(AutoNumeric.getNumber("#nc_"+r+"_"+t)),o=document.querySelector('input[name="c_p_'+r+"_"+t+'"]:checked').value,i=parseFloat(AutoNumeric.getNumber("#stk_"+r+"_"+t)),a=parseFloat(AutoNumeric.getNumber("#trans_"+t));e[t].push({contracts:n,cp:o,strike:i,transaction:a})}}return e},b_104_167:function(e){for(var t=[],r=0;r<jQuery("th").length-1;r++){t[r]=[0];for(e=1;e<=jQuery(".leg").length;e++){var n=parseFloat(AutoNumeric.getNumber("#stk_"+e+"_"+r));t[r].push(n)}}for(r=0;r<t.length;r++){var o=Math.max(...t[r]);t[r].push(o),t[r].push(o+1)}return t},loss:function(e){for(var t=[],r=0;r<e.length-2;r++)t.push(e[r]);return void 0!==e&&(e[e.length-1]<e[e.length-2]?"Unlimited":Math.min(...t))},profit:function(e){for(var t=[],r=0;r<e.length-2;r++)t.push(e[r]);return void 0!==e&&(e[e.length-1]>e[e.length-2]?"Unlimited":Math.max(...t))},be:function(e,t){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var o=1;o<e[n].length;o++)e[n][o]&&(Math.sign(e[n][o])==Math.sign(e[n][o-1])?r[n][o]=0:r[n][o]=t[n][o-1]+(t[n][o]-t[n][o-1])*(0-e[n][o-1])/(e[n][o]-e[n][o-1]));r[n].shift()}return r},calculate:function(){for(var e={size:parseFloat(AutoNumeric.getNumber("#size")),c:[],b:[parseFloat(AutoNumeric.getNumber("#start"))],increment:parseFloat(AutoNumeric.getNumber("#increment")),tr_summ:0,b___summ:0,g___summ:0,g5:parseFloat(AutoNumeric.getNumber("#cprice"))},t=this.odb(),r=this.b_104_167(),n=1;n<=67;n++)e.b[n]=e.b[n-1]+e.increment;var o=[];for(n=0;n<t.length;n++)0!=t[n][0].transaction&&(e.tr_summ+=t[n][0].transaction,o[n]=this.c__j(67,e.tr_summ,t[n],e.b));var i=[];for(n=0;n<t.length;n++)0!=t[n][0].transaction&&(e.b___summ+=t[n][0].transaction,i[n]=this.c__j(r[n].length-1,e.b___summ,t[n],r[n]));for(n=0;n<i.length;n++)""!=document.getElementById("trans_"+n).value?"Unlimited"!=this.loss(i[n])?0!=this.loss(i[n])?document.getElementById("mxl_"+n).innerHTML="$"+this.loss(i[n]).formatMoney(2,".",","):document.getElementById("mxl_"+n).innerHTML="-":document.getElementById("mxl_"+n).innerHTML=this.loss(i[n]):document.getElementById("mxl_"+n).innerHTML="-";for(n=0;n<i.length;n++)""!=document.getElementById("trans_"+n).value?"Unlimited"!=this.profit(i[n])?0!=this.profit(i[n])?document.getElementById("mxp_"+n).innerHTML="$"+this.profit(i[n]).formatMoney(2,".",","):document.getElementById("mxp_"+n).innerHTML="-":document.getElementById("mxp_"+n).innerHTML=this.profit(i[n]):document.getElementById("mxp_"+n).innerHTML="-";var a=[];for(n=0;n<t.length;n++){a[n]=[];for(var l=0;l<t[n].length;l++)a[n][l]=t[n][l].strike;a[n].push(1e9),a[n].unshift(0),a[n].sort((e,t)=>e-t)}var s=[];for(n=0;n<t.length;n++)0!=t[n][0].transaction&&(e.g___summ+=t[n][0].transaction,s[n]=this.c__j(a[n].length-1,e.g___summ,t[n],a[n]));var c=this.be(s,a);for(n=0;n<c.length;n++)if(""!=document.getElementById("trans_"+n).value)for(l=0;l<c[n].length;l++)0!=c[n][l]?document.getElementById("bp_"+(l+1)+"_"+n).innerHTML="$"+c[n][l].formatMoney(2,".",","):document.getElementById("bp_"+(l+1)+"_"+n).innerHTML="-";else for(l=0;l<c[n].length;l++)document.getElementById("bp_"+(l+1)+"_"+n).innerHTML="-";var u=[];for(l=1;l<8;l++){u[l]=[];for(n=0;n<11;n++)"-"==jQuery("#bp_"+l+"_"+n).html()?u[l][n]=0:u[l][n]=void 0}for(l=1;l<u.length;l++){var m=u[l].reduce((e,t)=>e+t,0);isNaN(m)?jQuery(".bp__"+l).css("display","table-row").removeClass("bphide"):jQuery(".bp__"+l).css("display","none").addClass("bphide")}7==jQuery(".bphide").length?jQuery("table.bp").addClass("hidename"):jQuery("table.bp").removeClass("hidename"),e.g3=e.tr_summ,e.g6=0==e.g5?0:e.g5*e.size,e.j3=e.g3*e.size,e.j5=e.j3+e.g6,""==document.getElementById("cprice").value?(e.j4="Enter Price",document.getElementById("action_cell").style.background="#e1e1e1",document.getElementById("action_cell").style.color="#000000"):e.j5>=0?(e.j4="Closed For Profit",document.getElementById("action_cell").style.background="green",document.getElementById("action_cell").style.color="#ffffff"):(e.j4="Closed for Loss",document.getElementById("action_cell").style.background="red",document.getElementById("action_cell").style.color="#ffffff"),document.getElementById("action").innerHTML=e.j4,""==document.getElementById("cprice").value?document.getElementById("profit_loss").innerHTML="$0.00":document.getElementById("profit_loss").innerHTML="$"+e.j5.formatMoney(2,".",","),document.getElementById("credit").innerHTML="$"+e.j3.formatMoney(2,".",","),document.getElementById("credit_share").innerHTML="$"+e.g3.formatMoney(2,".",","),document.getElementById("buyout").innerHTML="$"+e.g6.formatMoney(2,".",",");var d=[],h=[];for(n=0;n<o.length;n++)o[n]&&(d[n]=Math.min(...o[n]),h[n]=Math.max(...o[n]));var g=Highcharts.chart("chart",{chart:{spacingLeft:0,spacingRight:0,pinchType:"",panning:!1,events:{load:function(){var e=this,t=null,r=(Math.max(...h)-Math.min(...d))/68,n=(e.plotWidth,e.plotLeft,e.plotHeight/2),o=(e.renderer.image("https://i.ibb.co/WppHFbc/444.png",e.plotWidth/2+e.plotLeft-175,n,300,72).add(),e.renderer.button("ZOOM",30,80,function(){},{"text-align":"center"},null,null,null,null,null).css({}).add().toFront()),i=(t=e.renderer.button("&nbsp;&nbsp; UP",30,144,!0,function(){},{"text-align":"center"}).css({"text-align":"center"}).add().toFront(),e.renderer.button("DOWN",30,208,function(){s=e.yAxis[0].getExtremes().min,c=e.yAxis[0].getExtremes().max,u=e.xAxis[0].getExtremes().min,m=e.xAxis[0].getExtremes().max}).add().toFront()),a=e.renderer.button("RIGHT",30,176,function(){}).add().toFront(),l=e.renderer.button("&nbsp; LEFT",30,240,!0,function(){}).add().toFront(),s=(e.renderer.button("RESET",30,112,function(){e.zoomOut(),jQuery(".highcharts-root .highcharts-button").slideUp(),jQuery(".highcharts-root .highcharts-button").eq(0).slideDown(),jQuery(".highcharts-root .highcharts-button").eq(5).slideDown(),s=e.yAxis[0].getExtremes().min,c=e.yAxis[0].getExtremes().max,u=e.xAxis[0].getExtremes().min,m=e.xAxis[0].getExtremes().max}).add().toFront(),e.yAxis[0].getExtremes().min),c=e.yAxis[0].getExtremes().max,u=e.xAxis[0].getExtremes().min,m=e.xAxis[0].getExtremes().max;o.on("click",function(){jQuery(".highcharts-root .highcharts-button").slideDown(),s+=r,c-=r,u+=2.5,m-=2.5,e.yAxis[0].setExtremes(s,c),e.xAxis[0].setExtremes(u,m)}),t.on("click",function(){c+=r,s-=r,e.yAxis[0].setExtremes(s,c),e.xAxis[0].setExtremes(u,m)}),i.on("click",function(){c-=r,s+=r,e.yAxis[0].setExtremes(s,c),e.xAxis[0].setExtremes(u,m)}),a.on("click",function(){u-=2.5,m-=2.5,e.yAxis[0].setExtremes(s,c),e.xAxis[0].setExtremes(u,m)}),l.on("click",function(){m+=2.5,u+=2.5,e.yAxis[0].setExtremes(s,c),e.xAxis[0].setExtremes(u,m)}),jQuery(".highcharts-root .highcharts-button").slideUp(),jQuery(".highcharts-root .highcharts-button").eq(0).slideDown(),jQuery(".highcharts-root .highcharts-button").eq(5).slideDown()}}},mapNavigation:{enabled:!1},subtitle:{text:null},navigator:{enabled:!1},rangeSelector:{enabled:!1},scrollbar:{enabled:!1},title:{text:"P&L Graph after adjustment",style:{color:"#000",fontWeight:"bold",fontSize:"15px",textTransform:"uppercase",fontFamily:"Fjalla One"},margin:0},yAxis:{title:{text:null},startOnTick:!1,endOnTick:!1,showLastLabel:!0,opposite:!1,offset:35,tickPixelInterval:50,minorGridLineColor:"#e5e5e5",majorGridLineColor:"#e5e5e5",gridLineColor:"#e5e5e5",labels:{formatter:function(){return"$"+this.axis.defaultLabelFormatter.call(this)},align:"left",x:0,y:2,style:{color:"#adabab",fontSize:"8px"},enabled:!0},plotLines:[{color:"#000",width:1,value:0,zIndex:2}]},xAxis:{categories:e.b,lineColor:"#e5e5e5",title:{style:{color:"#e5e5e5",fontSize:9}},labels:{formatter:function(){return"$"+this.value.formatMoney(2,".",",")},enabled:!0,style:{color:"#adabab",fontSize:"8px"}}},credits:{enabled:!1},tooltip:{backgroundColor:"rgba(255,255,255,1)",borderColor:"#888888",useHTML:!0,zIndex:1200,crosshairs:!0,label:{attr:{zIndex:1200}},shared:!0,formatter:function(){var e="<span width=100% style='min-width: 235px;display:block;' class='tooltip-table'>";(e+="<span><span style='text-align:left; padding-left:0; font-size: 0.8em;margin-bottom:5px;display:block;font-weight:bold;'>$"+this.x+":</span></span>",this.points[0])&&(e+="<span style='display:flex;margin-bottom:2px;'><span style='width:70%;'><span style='background:#3368FF;color:#3368FF;display:inline-block;width:10px;height:10px;'></span> Initial Position </span><span style='font-weight: bold;'> "+("$"+this.points[0].y.formatMoney(2,".",","))+"</span></span>");for(var t=1;t<o.length;t++)o[t]&&(e+="<span style='display:flex;margin-bottom:2px;'><span style='width:70%;'><span style='background:"+rot_calc.colors[t-1]+";color:"+rot_calc.colors[t-1]+";display:inline-block;width:10px;height:10px;'></span> Adjustment #"+t+" </span><span style='font-weight: bold;'> $"+this.points[t].y.formatMoney(2,".",",")+"</span></span>");return e+="</span>"}},legend:{layout:"horizontal",align:"center",verticalAlign:"top",itemStyle:{font:"7pt Trebuchet MS, Verdana, sans-serif",color:"#7b7a7a"}},series:[{name:"Initial Position",data:o[0],marker:{symbol:"triangle",radius:3},color:"#3368FF"}],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{}}]}}),y=["square","diamond","circle","triangle-down","square","diamond","triangle-down","circle","diamond","square"];for(n=1;n<o.length;n++)g.addSeries({name:"Adjustment #"+n,data:o[n],marker:{symbol:y[n-1],radius:3},color:rot_calc.colors[n-1]},!1);g.redraw()},colors:["#FF8F32","#B3B2B1","#EED30D","#09CFE3","#BF4F02","#02BF0B","#0224BF","#0194BF","#78bd00","#ff0000"]}; jQuery(document).ready(function() { rot_calc.init(); });